\hypertarget{endianconv_8c_source}{}\section{endianconv.\+c}
\label{endianconv_8c_source}\index{src/endianconv.\+c@{src/endianconv.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* endinconv.c -- Endian conversions utilities.}
00002 \textcolor{comment}{ *}
00003 \textcolor{comment}{ * This functions are never called directly, but always using the macros}
00004 \textcolor{comment}{ * defined into endianconv.h, this way we define everything is a non-operation}
00005 \textcolor{comment}{ * if the arch is already little endian.}
00006 \textcolor{comment}{ *}
00007 \textcolor{comment}{ * Redis tries to encode everything as little endian (but a few things that need}
00008 \textcolor{comment}{ * to be backward compatible are still in big endian) because most of the}
00009 \textcolor{comment}{ * production environments are little endian, and we have a lot of conversions}
00010 \textcolor{comment}{ * in a few places because ziplists, intsets, zipmaps, need to be endian-neutral}
00011 \textcolor{comment}{ * even in memory, since they are serialied on RDB files directly with a single}
00012 \textcolor{comment}{ * write(2) without other additional steps.}
00013 \textcolor{comment}{ *}
00014 \textcolor{comment}{ * ----------------------------------------------------------------------------}
00015 \textcolor{comment}{ *}
00016 \textcolor{comment}{ * Copyright (c) 2011-2012, Salvatore Sanfilippo <antirez at gmail dot com>}
00017 \textcolor{comment}{ * All rights reserved.}
00018 \textcolor{comment}{ *}
00019 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}
00020 \textcolor{comment}{ * modification, are permitted provided that the following conditions are met:}
00021 \textcolor{comment}{ *}
00022 \textcolor{comment}{ *   * Redistributions of source code must retain the above copyright notice,}
00023 \textcolor{comment}{ *     this list of conditions and the following disclaimer.}
00024 \textcolor{comment}{ *   * Redistributions in binary form must reproduce the above copyright}
00025 \textcolor{comment}{ *     notice, this list of conditions and the following disclaimer in the}
00026 \textcolor{comment}{ *     documentation and/or other materials provided with the distribution.}
00027 \textcolor{comment}{ *   * Neither the name of Redis nor the names of its contributors may be used}
00028 \textcolor{comment}{ *     to endorse or promote products derived from this software without}
00029 \textcolor{comment}{ *     specific prior written permission.}
00030 \textcolor{comment}{ *}
00031 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"}
00032 \textcolor{comment}{ * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}
00033 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE}
00034 \textcolor{comment}{ * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE}
00035 \textcolor{comment}{ * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR}
00036 \textcolor{comment}{ * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF}
00037 \textcolor{comment}{ * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS}
00038 \textcolor{comment}{ * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN}
00039 \textcolor{comment}{ * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)}
00040 \textcolor{comment}{ * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE}
00041 \textcolor{comment}{ * POSSIBILITY OF SUCH DAMAGE.}
00042 \textcolor{comment}{ */}
00043 
00044 
00045 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{stdint}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00046 
00047 \textcolor{comment}{/* Toggle the 16 bit unsigned integer pointed by *p from little endian to}
00048 \textcolor{comment}{ * big endian */}
00049 \textcolor{keywordtype}{void} memrev16(\textcolor{keywordtype}{void} *p) \{
00050     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *x = p, t;
00051 
00052     t = x[0];
00053     x[0] = x[1];
00054     x[1] = t;
00055 \}
00056 
00057 \textcolor{comment}{/* Toggle the 32 bit unsigned integer pointed by *p from little endian to}
00058 \textcolor{comment}{ * big endian */}
00059 \textcolor{keywordtype}{void} memrev32(\textcolor{keywordtype}{void} *p) \{
00060     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *x = p, t;
00061 
00062     t = x[0];
00063     x[0] = x[3];
00064     x[3] = t;
00065     t = x[1];
00066     x[1] = x[2];
00067     x[2] = t;
00068 \}
00069 
00070 \textcolor{comment}{/* Toggle the 64 bit unsigned integer pointed by *p from little endian to}
00071 \textcolor{comment}{ * big endian */}
00072 \textcolor{keywordtype}{void} memrev64(\textcolor{keywordtype}{void} *p) \{
00073     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *x = p, t;
00074 
00075     t = x[0];
00076     x[0] = x[7];
00077     x[7] = t;
00078     t = x[1];
00079     x[1] = x[6];
00080     x[6] = t;
00081     t = x[2];
00082     x[2] = x[5];
00083     x[5] = t;
00084     t = x[3];
00085     x[3] = x[4];
00086     x[4] = t;
00087 \}
00088 
00089 uint16\_t intrev16(uint16\_t v) \{
00090     memrev16(&v);
00091     \textcolor{keywordflow}{return} v;
00092 \}
00093 
00094 uint32\_t intrev32(uint32\_t v) \{
00095     memrev32(&v);
00096     \textcolor{keywordflow}{return} v;
00097 \}
00098 
00099 uint64\_t intrev64(uint64\_t v) \{
00100     memrev64(&v);
00101     \textcolor{keywordflow}{return} v;
00102 \}
00103 
00104 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifdef} \textcolor{preprocessor}{REDIS\_TEST}
00105 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{stdio}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00106 
00107 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{UNUSED}\textcolor{preprocessor}{(}\textcolor{preprocessor}{x}\textcolor{preprocessor}{)} \textcolor{preprocessor}{(}\textcolor{preprocessor}{void}\textcolor{preprocessor}{)}\textcolor{preprocessor}{(}\textcolor{preprocessor}{x}\textcolor{preprocessor}{)}
00108 \textcolor{keywordtype}{int} endianconvTest(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[]) \{
00109     \textcolor{keywordtype}{char} buf[32];
00110 
00111     UNUSED(argc);
00112     UNUSED(argv);
00113 
00114     sprintf(buf,\textcolor{stringliteral}{"ciaoroma"});
00115     memrev16(buf);
00116     printf(\textcolor{stringliteral}{"%s\(\backslash\)n"}, buf);
00117 
00118     sprintf(buf,\textcolor{stringliteral}{"ciaoroma"});
00119     memrev32(buf);
00120     printf(\textcolor{stringliteral}{"%s\(\backslash\)n"}, buf);
00121 
00122     sprintf(buf,\textcolor{stringliteral}{"ciaoroma"});
00123     memrev64(buf);
00124     printf(\textcolor{stringliteral}{"%s\(\backslash\)n"}, buf);
00125 
00126     \textcolor{keywordflow}{return} 0;
00127 \}
00128 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
\end{DoxyCode}
