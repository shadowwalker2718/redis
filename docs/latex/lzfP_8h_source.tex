\hypertarget{lzfP_8h_source}{}\section{lzf\+P.\+h}
\label{lzfP_8h_source}\index{src/lzf\+P.\+h@{src/lzf\+P.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright (c) 2000-2007 Marc Alexander Lehmann <schmorp@schmorp.de>}
00003 \textcolor{comment}{ *}
00004 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without modifica-}
00005 \textcolor{comment}{ * tion, are permitted provided that the following conditions are met:}
00006 \textcolor{comment}{ *}
00007 \textcolor{comment}{ *   1.  Redistributions of source code must retain the above copyright notice,}
00008 \textcolor{comment}{ *       this list of conditions and the following disclaimer.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ *   2.  Redistributions in binary form must reproduce the above copyright}
00011 \textcolor{comment}{ *       notice, this list of conditions and the following disclaimer in the}
00012 \textcolor{comment}{ *       documentation and/or other materials provided with the distribution.}
00013 \textcolor{comment}{ *}
00014 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED}
00015 \textcolor{comment}{ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MER-}
00016 \textcolor{comment}{ * CHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO}
00017 \textcolor{comment}{ * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPE-}
00018 \textcolor{comment}{ * CIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,}
00019 \textcolor{comment}{ * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;}
00020 \textcolor{comment}{ * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,}
00021 \textcolor{comment}{ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTH-}
00022 \textcolor{comment}{ * ERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED}
00023 \textcolor{comment}{ * OF THE POSSIBILITY OF SUCH DAMAGE.}
00024 \textcolor{comment}{ *}
00025 \textcolor{comment}{ * Alternatively, the contents of this file may be used under the terms of}
00026 \textcolor{comment}{ * the GNU General Public License ("GPL") version 2 or any later version,}
00027 \textcolor{comment}{ * in which case the provisions of the GPL are applicable instead of}
00028 \textcolor{comment}{ * the above. If you wish to allow the use of your version of this file}
00029 \textcolor{comment}{ * only under the terms of the GPL and not to allow others to use your}
00030 \textcolor{comment}{ * version of this file under the BSD license, indicate your decision}
00031 \textcolor{comment}{ * by deleting the provisions above and replace them with the notice}
00032 \textcolor{comment}{ * and other provisions required by the GPL. If you do not delete the}
00033 \textcolor{comment}{ * provisions above, a recipient may use your version of this file under}
00034 \textcolor{comment}{ * either the BSD or the GPL.}
00035 \textcolor{comment}{ */}
00036 
00037 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{LZFP\_h}
00038 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{LZFP\_h}
00039 
00040 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{STANDALONE} 1 \textcolor{comment}{/* at the moment, this is ok. */}
00041 
00042 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \hyperlink{lzfP_8h_ab1c59581eafa11e55bf8f6ea8b877dd6}{STANDALONE}
00043 \textcolor{preprocessor}{#} \textcolor{preprocessor}{include} \textcolor{stringliteral}{"lzf.h"}
00044 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00045 
00046 \textcolor{comment}{/*}
00047 \textcolor{comment}{ * Size of hashtable is (1 << HLOG) * sizeof (char *)}
00048 \textcolor{comment}{ * decompression is independent of the hash table size}
00049 \textcolor{comment}{ * the difference between 15 and 14 is very small}
00050 \textcolor{comment}{ * for small blocks (and 14 is usually a bit faster).}
00051 \textcolor{comment}{ * For a low-memory/faster configuration, use HLOG == 13;}
00052 \textcolor{comment}{ * For best compression, use 15 or 16 (or more, up to 22).}
00053 \textcolor{comment}{ */}
00054 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{HLOG}
00055 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{HLOG} 16
00056 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00057 
00058 \textcolor{comment}{/*}
00059 \textcolor{comment}{ * Sacrifice very little compression quality in favour of compression speed.}
00060 \textcolor{comment}{ * This gives almost the same compression as the default code, and is}
00061 \textcolor{comment}{ * (very roughly) 15% faster. This is the preferred mode of operation.}
00062 \textcolor{comment}{ */}
00063 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{VERY\_FAST}
00064 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{VERY\_FAST} 1
00065 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00066 
00067 \textcolor{comment}{/*}
00068 \textcolor{comment}{ * Sacrifice some more compression quality in favour of compression speed.}
00069 \textcolor{comment}{ * (roughly 1-2% worse compression for large blocks and}
00070 \textcolor{comment}{ * 9-10% for small, redundant, blocks and >>20% better speed in both cases)}
00071 \textcolor{comment}{ * In short: when in need for speed, enable this for binary data,}
00072 \textcolor{comment}{ * possibly disable this for text data.}
00073 \textcolor{comment}{ */}
00074 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{ULTRA\_FAST}
00075 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{ULTRA\_FAST} 0
00076 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00077 
00078 \textcolor{comment}{/*}
00079 \textcolor{comment}{ * Unconditionally aligning does not cost very much, so do it if unsure}
00080 \textcolor{comment}{ */}
00081 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{STRICT\_ALIGN}
00082 \textcolor{preprocessor}{#} \textcolor{preprocessor}{if} \textcolor{preprocessor}{!}\textcolor{preprocessor}{(}\textcolor{preprocessor}{defined}\textcolor{preprocessor}{(}\textcolor{preprocessor}{\_\_i386}\textcolor{preprocessor}{)} \textcolor{preprocessor}{||} \textcolor{preprocessor}{defined} \textcolor{preprocessor}{(}\_\_amd64\textcolor{preprocessor}{)}\textcolor{preprocessor}{)}
00083 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{define} \textcolor{preprocessor}{STRICT\_ALIGN} 1
00084 \textcolor{preprocessor}{#} \textcolor{preprocessor}{else}
00085 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{define} \textcolor{preprocessor}{STRICT\_ALIGN} 0
00086 \textcolor{preprocessor}{#} \textcolor{preprocessor}{endif}
00087 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00088 
00089 \textcolor{comment}{/*}
00090 \textcolor{comment}{ * You may choose to pre-set the hash table (might be faster on some}
00091 \textcolor{comment}{ * modern cpus and large (>>64k) blocks, and also makes compression}
00092 \textcolor{comment}{ * deterministic/repeatable when the configuration otherwise is the same).}
00093 \textcolor{comment}{ */}
00094 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{INIT\_HTAB}
00095 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{INIT\_HTAB} 0
00096 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00097 
00098 \textcolor{comment}{/*}
00099 \textcolor{comment}{ * Avoid assigning values to errno variable? for some embedding purposes}
00100 \textcolor{comment}{ * (linux kernel for example), this is necessary. NOTE: this breaks}
00101 \textcolor{comment}{ * the documentation in lzf.h. Avoiding errno has no speed impact.}
00102 \textcolor{comment}{ */}
00103 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{AVOID\_ERRNO}
00104 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{AVOID\_ERRNO} 0
00105 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00106 
00107 \textcolor{comment}{/*}
00108 \textcolor{comment}{ * Whether to pass the LZF\_STATE variable as argument, or allocate it}
00109 \textcolor{comment}{ * on the stack. For small-stack environments, define this to 1.}
00110 \textcolor{comment}{ * NOTE: this breaks the prototype in lzf.h.}
00111 \textcolor{comment}{ */}
00112 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{LZF\_STATE\_ARG}
00113 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{LZF\_STATE\_ARG} 0
00114 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00115 
00116 \textcolor{comment}{/*}
00117 \textcolor{comment}{ * Whether to add extra checks for input validity in lzf\_decompress}
00118 \textcolor{comment}{ * and return EINVAL if the input stream has been corrupted. This}
00119 \textcolor{comment}{ * only shields against overflowing the input buffer and will not}
00120 \textcolor{comment}{ * detect most corrupted streams.}
00121 \textcolor{comment}{ * This check is not normally noticeable on modern hardware}
00122 \textcolor{comment}{ * (<1% slowdown), but might slow down older cpus considerably.}
00123 \textcolor{comment}{ */}
00124 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{CHECK\_INPUT}
00125 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{CHECK\_INPUT} 1
00126 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00127 
00128 \textcolor{comment}{/*}
00129 \textcolor{comment}{ * Whether to store pointers or offsets inside the hash table. On}
00130 \textcolor{comment}{ * 64 bit architetcures, pointers take up twice as much space,}
00131 \textcolor{comment}{ * and might also be slower. Default is to autodetect.}
00132 \textcolor{comment}{ */}
00133 \textcolor{comment}{/*#define LZF\_USER\_OFFSETS autodetect */}
00134 
00135 \textcolor{comment}{/*****************************************************************************/}
00136 \textcolor{comment}{/* nothing should be changed below */}
00137 
00138 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifdef} \_\_cplusplus
00139 \textcolor{preprocessor}{#} \textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{cstring}\textcolor{preprocessor}{>}
00140 \textcolor{preprocessor}{#} \textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{climits}\textcolor{preprocessor}{>}
00141 \textcolor{keyword}{using} \textcolor{keyword}{namespace} std;
00142 \textcolor{preprocessor}{#}\textcolor{preprocessor}{else}
00143 \textcolor{preprocessor}{#} \textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{string}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00144 \textcolor{preprocessor}{#} \textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{limits}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00145 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00146 
00147 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{LZF\_USE\_OFFSETS}
00148 \textcolor{preprocessor}{#} \textcolor{preprocessor}{if} \textcolor{preprocessor}{defined} \textcolor{preprocessor}{(}\textcolor{preprocessor}{WIN32}\textcolor{preprocessor}{)}
00149 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{define} \textcolor{preprocessor}{LZF\_USE\_OFFSETS} \textcolor{preprocessor}{defined}\textcolor{preprocessor}{(}\textcolor{preprocessor}{\_M\_X64}\textcolor{preprocessor}{)}
00150 \textcolor{preprocessor}{#} \textcolor{preprocessor}{else}
00151 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{if} \_\_cplusplus \textcolor{preprocessor}{>} 199711L
00152 \textcolor{preprocessor}{#}   \textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{cstdint}\textcolor{preprocessor}{>}
00153 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{else}
00154 \textcolor{preprocessor}{#}   \textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{stdint}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00155 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{endif}
00156 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{define} \textcolor{preprocessor}{LZF\_USE\_OFFSETS} \textcolor{preprocessor}{(}UINTPTR\_MAX \textcolor{preprocessor}{>} 0xffffffffU\textcolor{preprocessor}{)}
00157 \textcolor{preprocessor}{#} \textcolor{preprocessor}{endif}
00158 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00159 
00160 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} u8;
00161 
00162 \textcolor{preprocessor}{#}\textcolor{preprocessor}{if} \hyperlink{lzfP_8h_a457514b44b38b3933357c7723c137ba5}{LZF\_USE\_OFFSETS}
00163 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{LZF\_HSLOT\_BIAS} \textcolor{preprocessor}{(}\textcolor{preprocessor}{(}\textcolor{keyword}{const} \textcolor{preprocessor}{u8} \textcolor{preprocessor}{*}\textcolor{preprocessor}{)}\textcolor{preprocessor}{in\_data}\textcolor{preprocessor}{)}
00164   \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} LZF\_HSLOT;
00165 \textcolor{preprocessor}{#}\textcolor{preprocessor}{else}
00166 \textcolor{preprocessor}{#} \textcolor{preprocessor}{define} \textcolor{preprocessor}{LZF\_HSLOT\_BIAS} 0
00167   \textcolor{keyword}{typedef} \textcolor{keyword}{const} u8 *LZF\_HSLOT;
00168 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00169 
00170 \textcolor{keyword}{typedef} LZF\_HSLOT LZF\_STATE[1 << (\hyperlink{lzfP_8h_aaa67275c53290bd99d516d4b9a5d7d76}{HLOG})];
00171 
00172 \textcolor{preprocessor}{#}\textcolor{preprocessor}{if} \textcolor{preprocessor}{!}\hyperlink{lzfP_8h_a34203552492ece577af0130f4bc3afe5}{STRICT\_ALIGN}
00173 \textcolor{comment}{/* for unaligned accesses we need a 16 bit datatype. */}
00174 \textcolor{preprocessor}{#} \textcolor{preprocessor}{if} \textcolor{preprocessor}{USHRT\_MAX} \textcolor{preprocessor}{==} 65535
00175     \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} u16;
00176 \textcolor{preprocessor}{#} \textcolor{preprocessor}{elif} \textcolor{preprocessor}{UINT\_MAX} \textcolor{preprocessor}{==} 65535
00177     \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} u16;
00178 \textcolor{preprocessor}{#} \textcolor{preprocessor}{else}
00179 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{undef} \textcolor{preprocessor}{STRICT\_ALIGN}
00180 \textcolor{preprocessor}{#}  \textcolor{preprocessor}{define} \textcolor{preprocessor}{STRICT\_ALIGN} 1
00181 \textcolor{preprocessor}{#} \textcolor{preprocessor}{endif}
00182 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00183 
00184 \textcolor{preprocessor}{#}\textcolor{preprocessor}{if} \hyperlink{lzfP_8h_a35a67224caa202606b05b24f286bcb9e}{ULTRA\_FAST}
00185 \textcolor{preprocessor}{#} \textcolor{preprocessor}{undef} \textcolor{preprocessor}{VERY\_FAST}
00186 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00187 
00188 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
\end{DoxyCode}
