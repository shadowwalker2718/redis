\hypertarget{sds_8h_source}{}\section{sds.\+h}
\label{sds_8h_source}\index{src/sds.\+h@{src/sds.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* SDSLib 2.0 -- A C dynamic strings library}
00002 \textcolor{comment}{ *}
00003 \textcolor{comment}{ * Copyright (c) 2006-2015, Salvatore Sanfilippo <antirez at gmail dot com>}
00004 \textcolor{comment}{ * Copyright (c) 2015, Oran Agra}
00005 \textcolor{comment}{ * Copyright (c) 2015, Redis Labs, Inc}
00006 \textcolor{comment}{ * All rights reserved.}
00007 \textcolor{comment}{ *}
00008 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}
00009 \textcolor{comment}{ * modification, are permitted provided that the following conditions are met:}
00010 \textcolor{comment}{ *}
00011 \textcolor{comment}{ *   * Redistributions of source code must retain the above copyright notice,}
00012 \textcolor{comment}{ *     this list of conditions and the following disclaimer.}
00013 \textcolor{comment}{ *   * Redistributions in binary form must reproduce the above copyright}
00014 \textcolor{comment}{ *     notice, this list of conditions and the following disclaimer in the}
00015 \textcolor{comment}{ *     documentation and/or other materials provided with the distribution.}
00016 \textcolor{comment}{ *   * Neither the name of Redis nor the names of its contributors may be used}
00017 \textcolor{comment}{ *     to endorse or promote products derived from this software without}
00018 \textcolor{comment}{ *     specific prior written permission.}
00019 \textcolor{comment}{ *}
00020 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"}
00021 \textcolor{comment}{ * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}
00022 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE}
00023 \textcolor{comment}{ * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE}
00024 \textcolor{comment}{ * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR}
00025 \textcolor{comment}{ * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF}
00026 \textcolor{comment}{ * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS}
00027 \textcolor{comment}{ * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN}
00028 \textcolor{comment}{ * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)}
00029 \textcolor{comment}{ * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE}
00030 \textcolor{comment}{ * POSSIBILITY OF SUCH DAMAGE.}
00031 \textcolor{comment}{ */}
00032 
00033 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{\_\_SDS\_H}
00034 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{\_\_SDS\_H}
00035 
00036 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_MAX\_PREALLOC} \textcolor{preprocessor}{(}1024\textcolor{preprocessor}{*}1024\textcolor{preprocessor}{)}
00037 
00038 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{sys}\textcolor{preprocessor}{/}\textcolor{preprocessor}{types}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00039 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{stdarg}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00040 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{stdint}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00041 
00042 \textcolor{keyword}{typedef} \textcolor{keywordtype}{char} *sds;
00043 
00044 \textcolor{comment}{/* Note: sdshdr5 is never used, we just access the flags byte directly.}
00045 \textcolor{comment}{ * However is here to document the layout of type 5 SDS strings. */}
00046 \textcolor{keyword}{struct} \textcolor{keyword}{\_\_attribute\_\_} ((\_\_packed\_\_)) sdshdr5 \{
00047     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags; \textcolor{comment}{/* 3 lsb of type, and 5 msb of string length */}
00048     \textcolor{keywordtype}{char} buf[];
00049 \};
00050 \textcolor{keyword}{struct} \textcolor{keyword}{\_\_attribute\_\_} ((\_\_packed\_\_)) sdshdr8 \{
00051     uint8\_t len; \textcolor{comment}{/* used */}
00052     uint8\_t alloc; \textcolor{comment}{/* excluding the header and null terminator */}
00053     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags; \textcolor{comment}{/* 3 lsb of type, 5 unused bits */}
00054     \textcolor{keywordtype}{char} buf[];
00055 \};
00056 \textcolor{keyword}{struct} \textcolor{keyword}{\_\_attribute\_\_} ((\_\_packed\_\_)) sdshdr16 \{
00057     uint16\_t len; \textcolor{comment}{/* used */}
00058     uint16\_t alloc; \textcolor{comment}{/* excluding the header and null terminator */}
00059     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags; \textcolor{comment}{/* 3 lsb of type, 5 unused bits */}
00060     \textcolor{keywordtype}{char} buf[];
00061 \};
00062 \textcolor{keyword}{struct} \textcolor{keyword}{\_\_attribute\_\_} ((\_\_packed\_\_)) sdshdr32 \{
00063     uint32\_t len; \textcolor{comment}{/* used */}
00064     uint32\_t alloc; \textcolor{comment}{/* excluding the header and null terminator */}
00065     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags; \textcolor{comment}{/* 3 lsb of type, 5 unused bits */}
00066     \textcolor{keywordtype}{char} buf[];
00067 \};
00068 \textcolor{keyword}{struct} \textcolor{keyword}{\_\_attribute\_\_} ((\_\_packed\_\_)) sdshdr64 \{
00069     uint64\_t len; \textcolor{comment}{/* used */}
00070     uint64\_t alloc; \textcolor{comment}{/* excluding the header and null terminator */}
00071     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags; \textcolor{comment}{/* 3 lsb of type, 5 unused bits */}
00072     \textcolor{keywordtype}{char} buf[];
00073 \};
00074 
00075 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_5}  0
00076 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_8}  1
00077 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_16} 2
00078 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_32} 3
00079 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_64} 4
00080 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_MASK} 7
00081 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_BITS} 3
00082 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_HDR\_VAR}\textcolor{preprocessor}{(}\textcolor{preprocessor}{T}\textcolor{preprocessor}{,}\textcolor{preprocessor}{s}\textcolor{preprocessor}{)} \textcolor{keyword}{struct} \textcolor{preprocessor}{sdshdr}\textcolor{preprocessor}{##}\textcolor{preprocessor}{T} \textcolor{preprocessor}{*}\textcolor{preprocessor}{sh} \textcolor{preprocessor}{=} \textcolor{preprocessor}{(}\textcolor{keywordtype}{void}\textcolor{preprocessor}{*}\textcolor{preprocessor}{)}\textcolor{preprocessor}{(}\textcolor{preprocessor}{(}\textcolor{preprocessor}{s}\textcolor{preprocessor}{)}\textcolor{preprocessor}{-}\textcolor{preprocessor}{(}\textcolor{keyword}{sizeof}\textcolor{preprocessor}{(}\textcolor{keyword}{struct} \textcolor{preprocessor}{sdshdr}\textcolor{preprocessor}{##}\textcolor{preprocessor}{T}\textcolor{preprocessor}{)}\textcolor{preprocessor}{)}\textcolor{preprocessor}{)}\textcolor{preprocessor}{;}
00083 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_HDR}\textcolor{preprocessor}{(}\textcolor{preprocessor}{T}\textcolor{preprocessor}{,}\textcolor{preprocessor}{s}\textcolor{preprocessor}{)} \textcolor{preprocessor}{(}\textcolor{preprocessor}{(}\textcolor{keyword}{struct} \textcolor{preprocessor}{sdshdr}\textcolor{preprocessor}{##}\textcolor{preprocessor}{T} \textcolor{preprocessor}{*}\textcolor{preprocessor}{)}\textcolor{preprocessor}{(}\textcolor{preprocessor}{(}\textcolor{preprocessor}{s}\textcolor{preprocessor}{)}\textcolor{preprocessor}{-}\textcolor{preprocessor}{(}\textcolor{keyword}{sizeof}\textcolor{preprocessor}{(}\textcolor{keyword}{struct} \textcolor{preprocessor}{sdshdr}\textcolor{preprocessor}{##}\textcolor{preprocessor}{T}\textcolor{preprocessor}{)}\textcolor{preprocessor}{)}\textcolor{preprocessor}{)}\textcolor{preprocessor}{)}
00084 \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{SDS\_TYPE\_5\_LEN}\textcolor{preprocessor}{(}\textcolor{preprocessor}{f}\textcolor{preprocessor}{)} \textcolor{preprocessor}{(}\textcolor{preprocessor}{(}\textcolor{preprocessor}{f}\textcolor{preprocessor}{)}\textcolor{preprocessor}{>>}\hyperlink{sds_8h_aab3be62faa5a2354242a1c1036450a40}{SDS\_TYPE\_BITS}\textcolor{preprocessor}{)}
00085 
00086 \textcolor{keyword}{static} \textcolor{keyword}{inline} size\_t sdslen(\textcolor{keyword}{const} sds s) \{
00087     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags = s[-1];
00088     \textcolor{keywordflow}{switch}(flags&\hyperlink{sds_8h_a07564783f389fdd7772a8f61d55d9ddf}{SDS\_TYPE\_MASK}) \{
00089         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5}:
00090             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a387aebc42becc7d798cd1a33533da2de}{SDS\_TYPE\_5\_LEN}(flags);
00091         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a504136356f04bfa2fd616dd4c8fdd71c}{SDS\_TYPE\_8}:
00092             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(8,s)->len;
00093         \textcolor{keywordflow}{case} \hyperlink{sds_8h_aa54044bf70a30824caeb1bab3615bff2}{SDS\_TYPE\_16}:
00094             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(16,s)->len;
00095         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a0ad2103bbdaa2fe5511ce3279cb42293}{SDS\_TYPE\_32}:
00096             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(32,s)->len;
00097         \textcolor{keywordflow}{case} \hyperlink{sds_8h_ad03c6e0fdab3a871e10cce347e8bb4e6}{SDS\_TYPE\_64}:
00098             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(64,s)->len;
00099     \}
00100     \textcolor{keywordflow}{return} 0;
00101 \}
00102 
00103 \textcolor{keyword}{static} \textcolor{keyword}{inline} size\_t sdsavail(\textcolor{keyword}{const} sds s) \{
00104     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags = s[-1];
00105     \textcolor{keywordflow}{switch}(flags&\hyperlink{sds_8h_a07564783f389fdd7772a8f61d55d9ddf}{SDS\_TYPE\_MASK}) \{
00106         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5}: \{
00107             \textcolor{keywordflow}{return} 0;
00108         \}
00109         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a504136356f04bfa2fd616dd4c8fdd71c}{SDS\_TYPE\_8}: \{
00110             \hyperlink{sds_8h_a79b76920d1d9bc010926b7af167de89b}{SDS\_HDR\_VAR}(8,s);
00111             \textcolor{keywordflow}{return} sh->alloc - sh->len;
00112         \}
00113         \textcolor{keywordflow}{case} \hyperlink{sds_8h_aa54044bf70a30824caeb1bab3615bff2}{SDS\_TYPE\_16}: \{
00114             \hyperlink{sds_8h_a79b76920d1d9bc010926b7af167de89b}{SDS\_HDR\_VAR}(16,s);
00115             \textcolor{keywordflow}{return} sh->alloc - sh->len;
00116         \}
00117         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a0ad2103bbdaa2fe5511ce3279cb42293}{SDS\_TYPE\_32}: \{
00118             \hyperlink{sds_8h_a79b76920d1d9bc010926b7af167de89b}{SDS\_HDR\_VAR}(32,s);
00119             \textcolor{keywordflow}{return} sh->alloc - sh->len;
00120         \}
00121         \textcolor{keywordflow}{case} \hyperlink{sds_8h_ad03c6e0fdab3a871e10cce347e8bb4e6}{SDS\_TYPE\_64}: \{
00122             \hyperlink{sds_8h_a79b76920d1d9bc010926b7af167de89b}{SDS\_HDR\_VAR}(64,s);
00123             \textcolor{keywordflow}{return} sh->alloc - sh->len;
00124         \}
00125     \}
00126     \textcolor{keywordflow}{return} 0;
00127 \}
00128 
00129 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} sdssetlen(sds s, size\_t newlen) \{
00130     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags = s[-1];
00131     \textcolor{keywordflow}{switch}(flags&\hyperlink{sds_8h_a07564783f389fdd7772a8f61d55d9ddf}{SDS\_TYPE\_MASK}) \{
00132         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5}:
00133             \{
00134                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *fp = ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*)s)-1;
00135                 *fp = \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5} | (newlen << \hyperlink{sds_8h_aab3be62faa5a2354242a1c1036450a40}{SDS\_TYPE\_BITS});
00136             \}
00137             \textcolor{keywordflow}{break};
00138         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a504136356f04bfa2fd616dd4c8fdd71c}{SDS\_TYPE\_8}:
00139             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(8,s)->len = newlen;
00140             \textcolor{keywordflow}{break};
00141         \textcolor{keywordflow}{case} \hyperlink{sds_8h_aa54044bf70a30824caeb1bab3615bff2}{SDS\_TYPE\_16}:
00142             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(16,s)->len = newlen;
00143             \textcolor{keywordflow}{break};
00144         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a0ad2103bbdaa2fe5511ce3279cb42293}{SDS\_TYPE\_32}:
00145             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(32,s)->len = newlen;
00146             \textcolor{keywordflow}{break};
00147         \textcolor{keywordflow}{case} \hyperlink{sds_8h_ad03c6e0fdab3a871e10cce347e8bb4e6}{SDS\_TYPE\_64}:
00148             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(64,s)->len = newlen;
00149             \textcolor{keywordflow}{break};
00150     \}
00151 \}
00152 
00153 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} sdsinclen(sds s, size\_t inc) \{
00154     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags = s[-1];
00155     \textcolor{keywordflow}{switch}(flags&\hyperlink{sds_8h_a07564783f389fdd7772a8f61d55d9ddf}{SDS\_TYPE\_MASK}) \{
00156         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5}:
00157             \{
00158                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *fp = ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*)s)-1;
00159                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} newlen = \hyperlink{sds_8h_a387aebc42becc7d798cd1a33533da2de}{SDS\_TYPE\_5\_LEN}(flags)+inc;
00160                 *fp = \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5} | (newlen << \hyperlink{sds_8h_aab3be62faa5a2354242a1c1036450a40}{SDS\_TYPE\_BITS});
00161             \}
00162             \textcolor{keywordflow}{break};
00163         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a504136356f04bfa2fd616dd4c8fdd71c}{SDS\_TYPE\_8}:
00164             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(8,s)->len += inc;
00165             \textcolor{keywordflow}{break};
00166         \textcolor{keywordflow}{case} \hyperlink{sds_8h_aa54044bf70a30824caeb1bab3615bff2}{SDS\_TYPE\_16}:
00167             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(16,s)->len += inc;
00168             \textcolor{keywordflow}{break};
00169         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a0ad2103bbdaa2fe5511ce3279cb42293}{SDS\_TYPE\_32}:
00170             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(32,s)->len += inc;
00171             \textcolor{keywordflow}{break};
00172         \textcolor{keywordflow}{case} \hyperlink{sds_8h_ad03c6e0fdab3a871e10cce347e8bb4e6}{SDS\_TYPE\_64}:
00173             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(64,s)->len += inc;
00174             \textcolor{keywordflow}{break};
00175     \}
00176 \}
00177 
00178 \textcolor{comment}{/* sdsalloc() = sdsavail() + sdslen() */}
00179 \textcolor{keyword}{static} \textcolor{keyword}{inline} size\_t sdsalloc(\textcolor{keyword}{const} sds s) \{
00180     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags = s[-1];
00181     \textcolor{keywordflow}{switch}(flags&\hyperlink{sds_8h_a07564783f389fdd7772a8f61d55d9ddf}{SDS\_TYPE\_MASK}) \{
00182         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5}:
00183             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a387aebc42becc7d798cd1a33533da2de}{SDS\_TYPE\_5\_LEN}(flags);
00184         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a504136356f04bfa2fd616dd4c8fdd71c}{SDS\_TYPE\_8}:
00185             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(8,s)->alloc;
00186         \textcolor{keywordflow}{case} \hyperlink{sds_8h_aa54044bf70a30824caeb1bab3615bff2}{SDS\_TYPE\_16}:
00187             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(16,s)->alloc;
00188         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a0ad2103bbdaa2fe5511ce3279cb42293}{SDS\_TYPE\_32}:
00189             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(32,s)->alloc;
00190         \textcolor{keywordflow}{case} \hyperlink{sds_8h_ad03c6e0fdab3a871e10cce347e8bb4e6}{SDS\_TYPE\_64}:
00191             \textcolor{keywordflow}{return} \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(64,s)->alloc;
00192     \}
00193     \textcolor{keywordflow}{return} 0;
00194 \}
00195 
00196 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} sdssetalloc(sds s, size\_t newlen) \{
00197     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} flags = s[-1];
00198     \textcolor{keywordflow}{switch}(flags&\hyperlink{sds_8h_a07564783f389fdd7772a8f61d55d9ddf}{SDS\_TYPE\_MASK}) \{
00199         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a3b7b67f1efa75f6b78ae18ea853b1a91}{SDS\_TYPE\_5}:
00200             \textcolor{comment}{/* Nothing to do, this type has no total allocation info. */}
00201             \textcolor{keywordflow}{break};
00202         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a504136356f04bfa2fd616dd4c8fdd71c}{SDS\_TYPE\_8}:
00203             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(8,s)->alloc = newlen;
00204             \textcolor{keywordflow}{break};
00205         \textcolor{keywordflow}{case} \hyperlink{sds_8h_aa54044bf70a30824caeb1bab3615bff2}{SDS\_TYPE\_16}:
00206             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(16,s)->alloc = newlen;
00207             \textcolor{keywordflow}{break};
00208         \textcolor{keywordflow}{case} \hyperlink{sds_8h_a0ad2103bbdaa2fe5511ce3279cb42293}{SDS\_TYPE\_32}:
00209             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(32,s)->alloc = newlen;
00210             \textcolor{keywordflow}{break};
00211         \textcolor{keywordflow}{case} \hyperlink{sds_8h_ad03c6e0fdab3a871e10cce347e8bb4e6}{SDS\_TYPE\_64}:
00212             \hyperlink{sds_8h_a0f1b0d97d094e8505c1d46f95c6cbc30}{SDS\_HDR}(64,s)->alloc = newlen;
00213             \textcolor{keywordflow}{break};
00214     \}
00215 \}
00216 
00217 sds sdsnewlen(\textcolor{keyword}{const} \textcolor{keywordtype}{void} *init, size\_t initlen);
00218 sds sdsnew(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *init);
00219 sds sdsempty(\textcolor{keywordtype}{void});
00220 sds sdsdup(\textcolor{keyword}{const} sds s);
00221 \textcolor{keywordtype}{void} sdsfree(sds s);
00222 sds sdsgrowzero(sds s, size\_t len);
00223 sds sdscatlen(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *t, size\_t len);
00224 sds sdscat(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *t);
00225 sds sdscatsds(sds s, \textcolor{keyword}{const} sds t);
00226 sds sdscpylen(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *t, size\_t len);
00227 sds sdscpy(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *t);
00228 
00229 sds sdscatvprintf(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, va\_list ap);
00230 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifdef} \_\_GNUC\_\_
00231 sds sdscatprintf(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, ...)
00232     \textcolor{keyword}{\_\_attribute\_\_}((format(printf, 2, 3)));
00233 \textcolor{preprocessor}{#}\textcolor{preprocessor}{else}
00234 sds sdscatprintf(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, ...);
00235 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00236 
00237 sds sdscatfmt(sds s, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *fmt, ...);
00238 sds sdstrim(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *cset);
00239 \textcolor{keywordtype}{void} sdsrange(sds s, \textcolor{keywordtype}{int} start, \textcolor{keywordtype}{int} end);
00240 \textcolor{keywordtype}{void} sdsupdatelen(sds s);
00241 \textcolor{keywordtype}{void} sdsclear(sds s);
00242 \textcolor{keywordtype}{int} sdscmp(\textcolor{keyword}{const} sds s1, \textcolor{keyword}{const} sds s2);
00243 sds *sdssplitlen(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *s, \textcolor{keywordtype}{int} len, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *sep, \textcolor{keywordtype}{int} seplen, \textcolor{keywordtype}{int} *count);
00244 \textcolor{keywordtype}{void} sdsfreesplitres(sds *tokens, \textcolor{keywordtype}{int} count);
00245 \textcolor{keywordtype}{void} sdstolower(sds s);
00246 \textcolor{keywordtype}{void} sdstoupper(sds s);
00247 sds sdsfromlonglong(\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} value);
00248 sds sdscatrepr(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *p, size\_t len);
00249 sds *sdssplitargs(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *line, \textcolor{keywordtype}{int} *argc);
00250 sds sdsmapchars(sds s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *from, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *to, size\_t setlen);
00251 sds sdsjoin(\textcolor{keywordtype}{char} **argv, \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *sep);
00252 sds sdsjoinsds(sds *argv, \textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *sep, size\_t seplen);
00253 
00254 \textcolor{comment}{/* Low level functions exposed to the user API */}
00255 sds sdsMakeRoomFor(sds s, size\_t addlen);
00256 \textcolor{keywordtype}{void} sdsIncrLen(sds s, \textcolor{keywordtype}{int} incr);
00257 sds sdsRemoveFreeSpace(sds s);
00258 size\_t sdsAllocSize(sds s);
00259 \textcolor{keywordtype}{void} *sdsAllocPtr(sds s);
00260 
00261 \textcolor{comment}{/* Export the allocator used by SDS to the program using SDS.}
00262 \textcolor{comment}{ * Sometimes the program SDS is linked to, may use a different set of}
00263 \textcolor{comment}{ * allocators, but may want to allocate or free things that SDS will}
00264 \textcolor{comment}{ * respectively free or allocate. */}
00265 \textcolor{keywordtype}{void} *sds\_malloc(size\_t size);
00266 \textcolor{keywordtype}{void} *sds\_realloc(\textcolor{keywordtype}{void} *ptr, size\_t size);
00267 \textcolor{keywordtype}{void} sds\_free(\textcolor{keywordtype}{void} *ptr);
00268 
00269 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifdef} \textcolor{preprocessor}{REDIS\_TEST}
00270 \textcolor{keywordtype}{int} sdsTest(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[]);
00271 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00272 
00273 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
\end{DoxyCode}
